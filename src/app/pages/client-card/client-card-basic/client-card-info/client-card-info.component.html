<div class="info">
	<ss-loader *ngIf="isLoading$ | async"></ss-loader>
	<div class="header">
		<ss-headline size="h6" weight="semi-bold">Общая информация</ss-headline>
		<div *ngIf="!isEditing; else closeButton" class="header-controls">
			<a href="{{ (client$ | async)?.linkToDetail }}" class="header-controls-button" target="_blank" rel="noreferrer">
				<ss-icon name="box" [tooltip]="'Открыть модель клиента'" [theme]="TooltipTheme.MAIN" [position]="TooltipPosition.ABOVE"></ss-icon>
			</a>
			<ss-tooltip-menu *ngIf="visibleCalculateDistributor" icon="download">
				<ss-caption size="1">
					<a target="_blank" [href]="clientCardListFacade.methodFileLink">
						Методика расчета категории Дистрибьюторов
					</a>
				</ss-caption>
				<ss-caption size="1">
					<a target="_blank" [href]="clientCardListFacade.instructionFileLink">
						Инструкция по справочнику клиентов
					</a>
				</ss-caption>
			</ss-tooltip-menu>
			<ng-container *ngIf="canEdit">
				<ss-icon name="edit" (click)="onEditing(true)"></ss-icon>
			</ng-container>
		</div>
		<ng-template #closeButton>
			<ss-icon name="close" (click)="onEditing(false)"></ss-icon>
		</ng-template>
	</div>
	<form class="info-list" [formGroup]="infoForm" (submit)="$event.preventDefault()">
		<div class="info-list-item">
			<ss-text size="3" class="info-list-item-name">Код:</ss-text>
			<ss-text size="3" class="info-list-item-value">{{ (client$ | async)?.code | replace : '.' : ',' }}</ss-text>
		</div>
		<div class="info-list-item">
			<ss-text size="3" class="info-list-item-name">Название:</ss-text>
			<ss-input *ngIf="isEditing; else name" size="medium"
					  formControlName="name"
					  [error]="infoForm.controls.name.hasError('required') && infoForm.controls.name.touched ? 'Обязательное поле' : undefined"
					  (keydown)="validators($event)"
			></ss-input>
			<ng-template #name>
				<ss-text size="3" class="info-list-item-value">{{ (client$ | async)?.name }}</ss-text>
			</ng-template>
		</div>
		<div class="info-list-item">
			<ss-text size="3" class="info-list-item-name">Категория:</ss-text>
			<ss-text size="3" class="info-list-item-value">{{ (client$ | async)?.category?.name || '—' }}</ss-text>
		</div>
		<div class="info-list-item">
			<ss-text size="3" class="info-list-item-name">Статус:</ss-text>
			<ng-container *ngIf="client$ | async as client">
				<ss-select *ngIf="isEditing; else status" [error]="infoForm.controls.status.hasError('required') && infoForm.controls.status.touched ? 'Обязательное поле' : undefined"
						   (onChange)="infoForm.controls.status.setValue(($event))">
					<option value="">Выберите статус</option>

					<ng-container *ngFor="let status of statuses$ | async">
						<option *ngIf="status?.id != 7"
							[value]="status?.id!"
							[selected]="status?.id! === client!.status?.id">
							{{ status?.name }}
						</option>
					</ng-container>
				</ss-select>
				<ng-template #status>
					<ss-text size="3" class="info-list-item-value">{{ client!.status ? client!.status!.name : '—' }}</ss-text>
				</ng-template>
			</ng-container>
		</div>
		<div class="info-list-item">
			<ss-text size="3" class="info-list-item-name">Передано в юр.отдел:</ss-text>
			<ss-text size="3" class="info-list-item-value">{{ (client$ | async)?.transferredToLD ? '✔' : '—' }}</ss-text>
		</div>
		<div class="info-list-item">
			<ss-text size="3" class="info-list-item-name">Нет активности по клиенту:</ss-text>
			<ss-text size="3" class="info-list-item-value">{{ (client$ | async)?.noActivity ? '✔' : '—' }}</ss-text>
		</div>
		<div class="info-list-item">
			<ss-text size="3" class="info-list-item-name">Подотрасль:</ss-text>
			<ss-text size="3" class="info-list-item-value">{{ (client$ | async)?.saleDirection || '—' }}</ss-text>
			<ng-template #subsector>
				<ss-text size="3" class="info-list-item-value">{{ (client$ | async)?.saleDirection || '—' }}</ss-text>
			</ng-template>
		</div>
		<div class="info-list-item">
			<ss-text size="3" class="info-list-item-name">Регион:</ss-text>
			<ss-search-input *ngIf="isEditing; else region"
			                 searchType="region"
							 [error]="infoForm.controls.region.hasError('required') && infoForm.controls.region.touched ? 'Обязательное поле' : undefined"
							 [selectedItem]="(client$ | async)?.region"
							 (select)="selectRegion($event)"
							 (keydown)="validators($event)">
			</ss-search-input>
			<ng-template #region>
				<ss-text size="3" class="info-list-item-value">{{ (client$ | async)?.region?.name || '—' }}</ss-text>
			</ng-template>
		</div>
		<div *ngIf="(client$ | async)?.exclusive || (client$ | async)?.isDistributor" class="info-list-item price-list">
			<a *ngIf="visiblePriceList"
			   href="{{ (client$ | async)?.changePriceListLevelLink }}"
			   target="_blank">
					<ss-icon name="editNew" class="" height="13.2"></ss-icon>
			</a>
			<ss-text size="3" class="info-list-item-name">Текущий уровень прайс-листа:</ss-text>
			<ss-text size="3" class="info-list-item-value">{{ (client$ | async)?.category?.name || '—' }}</ss-text>
		</div>
		<div *ngIf="(client$ | async)?.exclusive || (client$ | async)?.isDistributor" class="info-list-item">
			<ss-text size="3" class="info-list-item-name">Среднемесячный объем продаж за квартал:</ss-text>
			<ss-text size="3" class="info-list-item-value">{{ (client$ | async)?.avgSalesVolume || '—' }}</ss-text>
		</div>
		<div class="info-list-item">
			<ss-text size="3" class="info-list-item-name">Эксклюзивный дистрибьютор в регионе:</ss-text>
			<ss-text size="3" class="info-list-item-value">{{ (client$ | async)?.exclusiveInRegion ? '✔' : '—' }}</ss-text>
		</div>
		<div class="info-list-item">
			<ss-text size="3" class="info-list-item-name">Эксклюзивный дистрибьютор:</ss-text>
			<ss-text size="3" class="info-list-item-value">{{ (client$ | async)?.exclusive ? '✔' : '—' }}</ss-text>
		</div>
		<div class="info-list-item">
			<ss-text size="3" class="info-list-item-name">Структура соответствует требованиям:</ss-text>
			<ss-text size="3" class="info-list-item-value">{{ (client$ | async)?.meetsRequirements ? '✔' : '—' }}</ss-text>
		</div>
		<div *ngIf="isEditing" class="info-list-item comment">
			<ss-text size="3" class="info-list-item-name">Комментарий:</ss-text>
			<ss-textarea size="medium" rows="4" placeholder="Введите текст" formControlName="comment"></ss-textarea>
		</div>
	</form>
	<div *ngIf="isEditing" class="footer">
		<ss-button (click)="saveChanges()">Сохранить</ss-button>
	</div>
</div>
