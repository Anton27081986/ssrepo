<div class="wrapper" (mousedown)="close()">
	<snab-card class="add-orders-form"
			   [headerRef]="header"
			   [bodyRef]="body"
			   [footerRef]="footer"
			   (mousedown)="$event.stopPropagation()">
		<ng-template #header>
			<div class="header">
				<snab-text [type]="TextType.Headline" [weight]="TextWeight.Semibold">
					Создать заказ
				</snab-text>
				<snab-button [type]="ButtonType.Flat"
							 [size]="Size.Large"
							 [icon]="IconType.ClearLarge" (click)="close()"></snab-button>
			</div>
		</ng-template>
		<ng-template #body>
			<div class="author-label">
				<snab-text [type]="TextType.Title" [weight]="TextWeight.Regular">
					Автор: Иванов И.И.
				</snab-text>
			</div>
			<form [formGroup]="addOrdersForm" class="content">
				<div class="content__row">
					<div class="content__row-item-tov">
							<ss-search-input
								searchType="tovs"
								label="ТП"
								[placeholder]="'Выберите товарную позицию'"
							(select)="onTovSelect($event)"/>
					</div>
					<div class="content__row-item-client">
							<ss-search-input
								searchType="client"
								label="Клиент"
								[placeholder]="'Выберите клиента'"
							(select)="onClientSelect($event)"/>
					</div>
					<div class="content__row-item-add-button">
						<snab-button text="Добавить ТП" [size]="Size.Large" (click)="addPosition()"></snab-button>
					</div>
				</div>
				<div formArrayName="positions" class="content__table-list">
					<div *ngFor="let position of positions.controls; let posIndex = index" [formGroupName]="posIndex">
						<ss-accordion [isExpanded]="true"
									  [title]="accordionTitle"
									  [isMpReservationOrders]="true"
									  (addRowPosition)="addDetailRow(posIndex)"
									  (removePosition)="removePosition(posIndex)">
							<ng-template [ngTemplateOutlet]="accordionContent"
										 [ngTemplateOutletContext]="{ position: position, posIndex: posIndex }">
							</ng-template>
						</ss-accordion>
					</div>
				</div>
			</form>
		</ng-template>
		<ng-template #footer>
			<div class="footer">
				<snab-button [type]="ButtonType.Secondary" [size]="Size.Large" text="Отмена"
							 (click)="close()"></snab-button>
				<snab-button [size]="Size.Large" text="Создать заказ" (click)="createOrder()"></snab-button>
			</div>
		</ng-template>
	</snab-card>
</div>

<ng-template #accordionContent let-position="position" let-posIndex="posIndex">
	<ng-container [formGroup]="position">
		<ng-container *ngIf="(position.get('details')).controls.length > 0">
			<div class="table-container">
				<table class="details-table">
					<thead>
					<tr>
						<th>Количество (план)</th>
						<th>Желаемая дата обеспечения</th>
						<th>Действия</th>
					</tr>
					</thead>
					<tbody formArrayName="details">
					<tr *ngFor="let detail of getDetails(position).controls; let detailIndex = index"
						[formGroupName]="detailIndex">
						<td>
							<snab-form-field [size]="Size.Large">
								<snab-input fieldCtrl
											placeholder="Введите количество"
											formControlName="quantity"></snab-input>
							</snab-form-field>
						</td>
						<td>
							<ss-date-time-picker [showTime]="false" formControlName="date"></ss-date-time-picker>
						</td>
						<td>
							<snab-button [type]="ButtonType.Flat"
										 [size]="Size.Large"
										 [icon]="IconType.Trash"
										 (click)="removeDetailRow(posIndex, detailIndex)"></snab-button>
						</td>
					</tr>
					</tbody>
				</table>
			</div>
		</ng-container>
	</ng-container>
</ng-template>



