<div class="app-mp-reservation-orders__header">
	<snab-text [type]="TextType.Headline" [weight]="TextWeight.Semibold">Реестр по обеспечению и персонификации заказов
		МП
	</snab-text>
	<div class="app-mp-reservation-orders__header-filter">
		<snab-button text="Добавить заказ" [size]="Size.Large" (click)="openPopupAddOrder()"
		></snab-button>
		<snab-button text="Назначить дату обеспечения" [size]="Size.Large"
					 [disabled]="!selectedOrders.size"
					 (click)="openPopupDateProvision()"
		></snab-button>
		<snab-button [type]="ButtonType.Outline" [size]="Size.Large"
					 [iconPosition]="IconPosition.OnlyIcon"
					 [icon]="IconType.FileNotFound" (click)="downloadInstr()">
		</snab-button>
		<ss-dropdown-button [isDropdownVisible]="!isLoader()" title="Фильтры">
			<ss-filters [isFiltersVisible]="!isLoader()" [(filters)]="filters"
						(applyFilter)="getFilteredOrders(true);">
			</ss-filters>
		</ss-dropdown-button>
	</div>
</div>
<div class="app-mp-reservation-orders__body">
	<ng-container *ngIf="orders() as orderList">
		<table class="table">
			<thead class="table__thead table__thead__sticky">
			<tr>
				<th>
					<input type="checkbox"
						   [checked]="isAllSelected()"
						   (change)="toggleSelectAll($event)"/>
				</th>
				<th>
					<snab-text [type]="TextType.Title" [weight]="TextWeight.Medium">Код заказа</snab-text>
				</th>
				<th>
					<snab-text [type]="TextType.Title" [weight]="TextWeight.Medium">Статус</snab-text>
				</th>
				<th>
					<snab-text [type]="TextType.Title" [weight]="TextWeight.Medium">Дата заказа</snab-text>
				</th>
				<th>
					<snab-text [type]="TextType.Title" [weight]="TextWeight.Medium">Заказчик</snab-text>
				</th>
				<th>
					<snab-text [type]="TextType.Title" [weight]="TextWeight.Medium">ТП</snab-text>
				</th>
				<th>
					<snab-text [type]="TextType.Title" [weight]="TextWeight.Medium">Клиент</snab-text>
				</th>
				<th>
					<snab-text [type]="TextType.Title" [weight]="TextWeight.Medium">Кол-во</snab-text>
				</th>
				<th>
					<snab-text [type]="TextType.Title" [weight]="TextWeight.Medium">Ед. изм.</snab-text>
				</th>
				<th>
					<snab-text [type]="TextType.Title" [weight]="TextWeight.Medium">Обеспечение</snab-text>
				</th>
				<th>
					<snab-text [type]="TextType.Title" [weight]="TextWeight.Medium">МУТМЗ</snab-text>
				</th>
				<th>
					<snab-text [type]="TextType.Title" [weight]="TextWeight.Medium">Остатки</snab-text>
				</th>
				<th>
					<snab-text [type]="TextType.Title" [weight]="TextWeight.Medium">Дата производства</snab-text>
				</th>
				<th>
					<snab-text [type]="TextType.Title" [weight]="TextWeight.Medium">Дата обеспечения</snab-text>
				</th>
				<th>
					<snab-text [type]="TextType.Title" [weight]="TextWeight.Medium">История изменений по заявке
					</snab-text>
				</th>
			</tr>
			</thead>
			<tbody>
			<tr *ngFor="let order of orders()?.items">
				<td>
					<input type="checkbox"
						   [checked]="selectedOrders?.has(order.id)"
						   (change)="onCheckboxChange($event, order.id)"/>
				</td>
				<td>
					<snab-link [type]="TextType.Body" [text]="order.id.toString()"
							   (click)="goToOrderCard(order.id)">{{order.id}}</snab-link>
				</td>
				<td>
					<snab-text [type]="TextType.Body" [weight]="TextWeight.Semibold">{{ order.status?.name }}
					</snab-text>
				</td>
				<td>
					<snab-text [type]="TextType.Body">{{ order.dateCreated | date: 'dd.MM.yyyy' }}</snab-text>
				</td>
				<td>
					<snab-link [type]="TextType.Body" [text]="order.author.name"></snab-link>
				</td>
				<td>
					<snab-link snab-tooltip
							   [type]="TextType.Body"
							   [text]="order.tov?.name!"
							   [tooltipText]="order.tov.name"></snab-link>
				</td>
				<td>
					<snab-text [type]="TextType.Body">{{ order.client?.name }}</snab-text>
				</td>
				<td>
					<snab-text [type]="TextType.Body">{{ order.totalAmount }}</snab-text>
				</td>
				<td>
					<snab-text [type]="TextType.Body">{{ order.tovUnit }}</snab-text>
				</td>
				<td>
					<ss-chart-line [data]="getChartData(order.provision)"></ss-chart-line>
				</td>
				<td>
					<snab-link [type]="TextType.Body" [text]="order.manager?.name!"></snab-link>
				</td>
				<td>
					<snab-link [type]="TextType.Body" [text]="order.stockBalance.toString()"
							   (click)="openPopupRemnantDetailsOrder(order.id)"></snab-link>
				</td>
				<td>
					<snab-text [type]="TextType.Body">
						<ng-container *ngFor="let prodDate of order.provision?.provisionDetails">
							{{ prodDate.productionDate  | date: 'dd.MM.yyyy' }}
						</ng-container>
					</snab-text>
				</td>
				<td>
					<snab-text [type]="TextType.Body">
						<ng-container *ngFor="let provDate of order.provision?.provisionDetails">
							{{ provDate.provisionDate  | date: 'dd.MM.yyyy' }}
						</ng-container>
					</snab-text>
				</td>
				<td>
					<snab-link [type]="TextType.Body" [text]="'История'"
							   (click)="openPopupHistoryOrder(order.id)"></snab-link>
				</td>
			</tr>
			</tbody>
		</table>
		<div class="pagination">
			<ss-pagination [total]="orderList.total" [pageSize]="pageSize" [pageIndex]="pageIndex"
						   (changeIndex)="ordersTableIndexChange($event)"></ss-pagination>
		</div>
	</ng-container>
</div>

