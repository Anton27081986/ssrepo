<div
	class="wrapper"
	(mousedown)="close()"
>
	<ss-card
		class="specification"
		padding="0"
		(mousedown)="$event.stopPropagation()"
	>
		<div class="header">
			<ss-text size="2"
				>{{ spec ? 'Редактировать' : 'Добавить' }} спецификацию
				затрат</ss-text
			>
			<ss-icon
				name="close"
				(click)="close()"
			></ss-icon>
		</div>
		<form
			class="content"
			[formGroup]="addSpecificationForm"
		>
			<div class="content__column">
				<ss-search-input
					searchType="cost-article"
					label="Статья"
					placeholder="Выберите из списка"
					[selectedItem]="cost"
					[error]="
						addSpecificationForm.controls.costId.touched &&
						addSpecificationForm.controls.costId.errors?.required
							? 'Обязательное поле'
							: undefined
					"
					(focusout)="
						resetValueControl(
							$event,
							addSpecificationForm.controls.costId,
							'costId'
						)
					"
					(input)="
						resetValueControl(
							$event,
							addSpecificationForm.controls.costId,
							'costId'
						)
					"
					(select)="onArticleSelect($event)"
				>
				</ss-search-input>
				<ss-search-input
					searchType="fa-objects"
					label="Объект ОС/НМА"
					placeholder="Выберите из списка"
					[selectedItem]="faObject"
					[error]="
						addSpecificationForm.controls.faObjectId.touched &&
						addSpecificationForm.controls.faObjectId.errors
							?.required
							? 'Обязательное поле'
							: undefined
					"
					(focusout)="
						resetValueControl(
							$event,
							addSpecificationForm.controls.faObjectId,
							'faObject'
						)
					"
					(input)="
						resetValueControl(
							$event,
							addSpecificationForm.controls.faObjectId,
							'faObject'
						)
					"
					(select)="onFaObjectSelect($event)"
					(click)="
						addSpecificationForm.controls.faObjectId.setErrors(null)
					"
				>
				</ss-search-input>
				<ss-search-input
					searchType="projects"
					label="Проект"
					placeholder="Выберите из списка"
					[selectedItem]="project"
					[error]="
						addSpecificationForm.controls.projectId.touched &&
						addSpecificationForm.controls.projectId.errors?.required
							? 'Обязательное поле'
							: undefined
					"
					(focusout)="
						resetValueControl(
							$event,
							addSpecificationForm.controls.projectId,
							'project'
						)
					"
					(input)="
						resetValueControl(
							$event,
							addSpecificationForm.controls.projectId,
							'project'
						)
					"
					(select)="onProjectSelect($event)"
					(click)="
						addSpecificationForm.controls.projectId.setErrors(null)
					"
				>
				</ss-search-input>
			</div>
			<div class="content__column">
				<ss-search-input
					searchType="user"
					label="Сотрудник"
					placeholder="Выберите из списка"
					[selectedItem]="spec ? spec.user : user"
					[error]="
						addSpecificationForm.controls.userId.touched &&
						addSpecificationForm.controls.userId.errors?.required
							? 'Обязательное поле'
							: undefined
					"
					(select)="onUserSelect($event)"
				>
				</ss-search-input>
				<ss-search-input
					searchType="depts"
					label="Отдел"
					placeholder="Выберите из списка"
					[selectedItem]="myDept"
					[error]="
						addSpecificationForm.controls.deptId.touched &&
						addSpecificationForm.controls.deptId.errors?.required
							? 'Обязательное поле'
							: undefined
					"
					(click)="
						addSpecificationForm.controls.deptId.setErrors(null)
					"
					(select)="onDeptSelect($event)"
				>
				</ss-search-input>
				<ss-search-input
					searchType="mfs-sections"
					label="Производственный участок"
					placeholder="Выберите из списка"
					[selectedItem]="mySection"
					[error]="
						addSpecificationForm.controls.sectionId.touched &&
						addSpecificationForm.controls.sectionId.errors?.required
							? 'Обязательное поле'
							: undefined
					"
					(focusout)="
						resetValueControl(
							$event,
							addSpecificationForm.controls.sectionId,
							'mySection'
						)
					"
					(input)="
						resetValueControl(
							$event,
							addSpecificationForm.controls.sectionId,
							'mySection'
						)
					"
					(select)="onSectionSelect($event)"
					(click)="
						addSpecificationForm.controls.sectionId.setErrors(null)
					"
				>
				</ss-search-input>
				<ss-numeric-input
					formControlName="sum"
					label="Сумма"
					[error]="
						addSpecificationForm.controls.sum.touched &&
						addSpecificationForm.controls.sum.errors?.required
							? 'Обязательное поле'
							: amountValidator(addSpecificationForm.controls.sum)
								? 'Некорректное значение'
								: undefined
					"
				>
				</ss-numeric-input>
			</div>
		</form>
		<div class="footer">
			<ss-button
				type="muted"
				size="small"
				(click)="close()"
				>Отмена</ss-button
			>
			@if (spec) {
				<ss-button
					type="primary"
					size="small"
					(click)="updateSpecification()"
					>Сохранить изменения</ss-button
				>
			} @else {
				<ss-button
					type="primary"
					size="small"
					(click)="addSpecification()"
					>Добавить новую спецификацию</ss-button
				>
			}
		</div>
	</ss-card>
</div>
