<div
	class="wrapper"
	(click)="close()"
>
	<snab-card
		class="qualification"
		[headerRef]="header"
		[bodyRef]="body"
		[footerRef]="footer"
		(click)="$event.stopPropagation()"
	>
	</snab-card>
</div>

<ng-template #header>
	<div class="qualification__header">
		<ss-headline size="h6">Уточнить заказ №{{ id }}</ss-headline>
		<snab-button
			[type]="ButtonType.Flat"
			[size]="Size.Default"
			[icon]="IconType.ClearLarge"
			[iconPosition]="IconPosition.OnlyIcon"
			(click)="close()"
		>
		</snab-button>
	</div>
</ng-template>

<ng-template #body>
	<form
		class="qualification__body"
		[formGroup]="changeClarifyOrderForm"
	>
		@if (tov) {
			<ss-search-input
				[selectedItem]="tov"
				[searchType]="'tovsManufacturing'"
				[error]="
					changeClarifyOrderForm.controls.tov.touched &&
					changeClarifyOrderForm.controls.tov.errors?.required
						? 'Обязательное поле'
						: undefined
				"
				(select)="onTovSelect($event)"
				(blurEvent)="
					this.changeClarifyOrderForm.controls.tov.setValue(null)
				"
			>
			</ss-search-input>
		}
		<snab-button
			class="qualification__add-row"
			text="Добавить"
			[size]="Size.Large"
            [disabled]="items.length >= MAX_ROWS"
			(click)="addRow()"
		></snab-button>
		<ss-table-v2>
			<tr
				*ngFor="let item of items; let i = index; trackBy: trackByItem"
				mp-reservation-orders-card-popup-qualification-tr
				[item]="item"
                [canRemove]="items.length > 1"
                (removeRow)="removeRow(i)"
			></tr>
		</ss-table-v2>
	</form>
</ng-template>

<ng-template #footer>
	<div class="qualification__footer">
		<snab-button
			text="Отмена"
			[type]="ButtonType.Secondary"
			[size]="Size.Large"
			(click)="openPopupCancelAction()"
		></snab-button>
		<snab-button
			text="Уточнить"
			[size]="Size.Large"
			(click)="clarifyOrder()"
		></snab-button>
	</div>
</ng-template>
