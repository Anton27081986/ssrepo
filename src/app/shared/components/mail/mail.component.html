<ss-card-dropdown title="Создать сообщение" titleSize="2">
	<form class="mail" [formGroup]="mailForm" (submit)="$event.preventDefault()">
		<div class="requisites">
			<ss-input label="Тема:"
					  size="medium"
					  placeholder="Введите тему сообщения"
					  formControlName="subject"
					  value="{{(subject$ | async)}}"
					  [error]="mailForm.controls.subject.hasError('required') && mailForm.controls.subject.touched ? 'Поле обязательно для заполнения' : undefined"
			></ss-input>
			<ss-chips-user-search label="Кому:" size="medium" ([selectedUsers])="toUsers"></ss-chips-user-search>
			<ss-chips-user-search label="Копия:" size="medium" [selectedUsers]="toUsersCopy"></ss-chips-user-search>
		</div>
		<div class="reply" *ngIf="selectedMessageToReply">
			<ss-icon width="28" height="28" name="reply"></ss-icon>
			<div class="reply-message">
				<ss-text size="2" weight="semi-bold" class="reply-author">В ответ: {{ selectedMessageToReply.author?.name }}</ss-text>
				<div class="reply-text" [innerHTML]="selectedMessageToReply.text"></div>
			</div>
			<ss-icon width="12" height="12" name="iconClose" class="close-reply" (click)="closeReply()"></ss-icon>
		</div>
		<div class="editor" [ngClass]="{'error': mailForm.controls.text.hasError('required') && mailForm.controls.text.touched}">
			<div *ngIf="isCustomEditorLoaded" class="editor-controls">
				<div class="section undo-redo">
					<ss-icon height="16" width="16" name="undo" (click)="myEditorButtons[EditorButtons.undo].editorElement?.click()"></ss-icon>
					<ss-icon height="16" width="16" name="redo" (click)="myEditorButtons[EditorButtons.redo].editorElement?.click()"></ss-icon>
				</div>
				<span class="separator"></span>
				<div class="section">
					<span class="font-family" (click)="myEditorButtons[EditorButtons.fontFamily].editorElement?.click(); onFontFamilyInit(myEditorButtons[EditorButtons.fontFamily].editorElement)">
						<span>{{ fontFamily }}</span>
						<ss-icon height="12" width="12" name="arrowDown"></ss-icon>
					</span>
				</div>
				<span class="separator"></span>
				<div class="section">
					<span class="font-size" (click)="myEditorButtons[EditorButtons.fontSize].editorElement?.click(); onFontSizeInit(myEditorButtons[EditorButtons.fontSize].editorElement)">
						<span>{{ fontSize }}</span>
						<ss-icon height="12" width="12" name="arrowDown"></ss-icon>
					</span>
				</div>
				<span class="separator"></span>
				<div class="section">
					<ss-icon height="24" width="24" name="semibold" (click)="myEditorButtons[EditorButtons.bold].editorElement?.click()"></ss-icon>
					<ss-icon height="24" width="24" name="italic" (click)="myEditorButtons[EditorButtons.italic].editorElement?.click()"></ss-icon>
					<ss-icon height="24" width="24" name="underline" (click)="myEditorButtons[EditorButtons.underline].editorElement?.click()"></ss-icon>
				</div>
				<span class="separator"></span>
				<div class="section font-colors">
					<span (click)="myEditorButtons[EditorButtons.fontColor].editorElement?.click()">
						<ss-icon height="24" width="24" name="textColor"></ss-icon>
						<ss-icon height="12" width="12" name="arrowDown"></ss-icon>
					</span>
					<span (click)="myEditorButtons[EditorButtons.fontBackgroundColor].editorElement?.click()">
						<ss-icon height="24" width="24" name="textBackground"></ss-icon>
						<ss-icon height="12" width="12" name="arrowDown"></ss-icon>
					</span>
				</div>
				<span class="separator"></span>
				<div class="section font-colors">
					<span (click)="myEditorButtons[EditorButtons.alignment].editorElement?.click()">
						<ss-icon height="24" width="24" name="alignment"></ss-icon>
						<ss-icon height="12" width="12" name="arrowDown"></ss-icon>
					</span>
					<span (click)="myEditorButtons[EditorButtons.bulletedList].editorElement?.click()">
						<ss-icon height="24" width="24" name="bulletList"></ss-icon>
						<ss-icon height="12" width="12" name="arrowDown"></ss-icon>
					</span>
					<span (click)="myEditorButtons[EditorButtons.numberedList].editorElement?.click()">
						<ss-icon height="24" width="24" name="numberedList"></ss-icon>
						<ss-icon height="12" width="12" name="arrowDown"></ss-icon>
					</span>
				</div>
				<span class="separator"></span>
				<div class="section">
					<ss-icon height="24" width="24" name="blockquote" (click)="myEditorButtons[EditorButtons.blockQuote].editorElement?.click()"></ss-icon>
					<ss-icon height="24" width="24" name="link" (click)="myEditorButtons[EditorButtons.link].editorElement?.click()"></ss-icon>
				</div>
				<span class="separator"></span>
				<div class="section">
					<ss-icon height="24" width="24" name="removeFormat" (click)="myEditorButtons[EditorButtons.removeFormat].editorElement?.click()"></ss-icon>
				</div>
			</div>
			<ckeditor [editor]="Editor" formControlName="text" #editor></ckeditor>
			<ss-caption class="error" size="1" *ngIf="mailForm.controls.text.hasError('required') && mailForm.controls.text.touched">Поле обязательно для заполнения</ss-caption>
		</div>
		<div *ngIf="files.length" class="files">
			<ss-attachment *ngFor="let file of files" title="{{file.fileName}}" size="{{file.size}}" (delete)="deleteFile(file.id!)" [readonly]="false"></ss-attachment>
		</div>
		<div class="controls">
			<ss-caption>
				<input type="checkbox" formControlName="isPrivate" />
				Доступ для просмотра только адресатам
			</ss-caption>
			<div class="upload-file">
				<label for="upload-file">
					<ss-icon height="20" width="20" name="paperclip"></ss-icon>
					<ss-caption>Прикрепить файл</ss-caption>
				</label>
				<input type="file" id="upload-file"
					   accept=".jpg, .jpeg, .png, .gif, .doc, .docx, .xls, .xlsx, .pdf, .mp4, .mov, .avi"
					   multiple
					   (change)="uploadFile($event)"
				/>
			</div>
			<ss-button class="send-button" type="primary" size="medium" (click)="sendMessage()">Отправить</ss-button>
		</div>
	</form>
</ss-card-dropdown>

