<ss-card-dropdown
	title="Создать сообщение"
	titleSize="2"
>
	<form
		class="mail"
		[formGroup]="mailForm"
		(submit)="$event.preventDefault()"
	>
		<div class="requisites">
			<ss-input
				label="Тема:"
				size="medium"
				placeholder="Введите тему"
				formControlName="subject"
				maxlength="32"
				[error]="
					mailForm.controls.subject.hasError('required') &&
					mailForm.controls.subject.touched
						? 'Поле обязательно для заполнения'
						: undefined
				"
				(input)="closeReply()"
			></ss-input>
			<ss-chips-user-search
				label="Кому:"
				size="medium"
				[selectedItems]="toUsers"
			></ss-chips-user-search>
			<ss-chips-user-search
				label="Копия:"
				size="medium"
				[selectedItems]="toUsersCopy"
			></ss-chips-user-search>
		</div>
		<div
			*ngIf="repliedMessage$ | async"
			class="reply"
		>
			<ss-icon
				width="28"
				height="28"
				name="reply"
			></ss-icon>
			<div class="reply-message">
				<ss-text
					size="2"
					weight="semi-bold"
					class="reply-author"
					>В ответ:
					{{
						(repliedMessage$ | async)?.message?.author?.name
					}}</ss-text
				>
				<div
					class="reply-text"
					[innerHTML]="(repliedMessage$ | async)?.message?.text"
				></div>
			</div>
			<ss-icon
				width="12"
				height="12"
				name="close"
				class="close-reply"
				(click)="closeReply()"
			></ss-icon>
		</div>
		<div
			class="editor"
			[ngClass]="{
				error:
					mailForm.controls.text.hasError('required') &&
					mailForm.controls.text.touched,
			}"
		>
			<div
				#editorContainerElement
				class="editor-container editor-container_classic-editor"
			>
				<div class="editor-container__editor">
					<div #editorElement>
						<ckeditor
							*ngIf="isLayoutReady"
							formControlName="text"
							[editor]="Editor"
							[config]="config"
						/>
					</div>
				</div>
			</div>
			<ss-caption
				*ngIf="
					mailForm.controls.text.hasError('required') &&
					mailForm.controls.text.touched
				"
				class="error"
				size="1"
				>Поле обязательно для заполнения</ss-caption
			>
		</div>
		<div
			*ngIf="(messageFiles$ | async)?.length"
			class="files"
		>
			<ss-attachment
				*ngFor="let file of messageFiles$ | async"
				title="{{ file.fileName }}"
				size="{{ file.size }}"
				[readonly]="false"
				(delete)="deleteFile(file.id!)"
			></ss-attachment>
		</div>
		<div class="controls">
			<ss-caption>
				<input
					type="checkbox"
					formControlName="isPrivate"
				/>
				Доступ для просмотра только адресатам
			</ss-caption>
			<div class="upload-file">
				<label for="upload-file">
					<ss-icon
						height="20"
						width="20"
						name="paperclip"
					></ss-icon>
					<ss-caption>Прикрепить файл</ss-caption>
				</label>
				<input
					type="file"
					id="upload-file"
					accept=".jpg, .jpeg, .png, .gif, .doc, .docx, .xls, .xlsx, .pdf, .mp4, .mov, .avi"
					multiple
					(change)="uploadFile($event)"
				/>
			</div>
			<ss-button
				class="send-button"
				type="primary"
				size="medium"
				(click)="onSendMessage()"
				>Отправить</ss-button
			>
		</div>
	</form>
</ss-card-dropdown>
